"object"!==typeof DotmetricsJSON&&(DotmetricsJSON=window.JSON);(function(){function w(a){this.foundVideoPlayers=[];this.SearchForNewVideoPlayersInterval=5E3;this.newVideoFoundCallback=a;this.init=function(){this.trackVideos()};this.trackVideos=function(){function a(a){a.contentWindow&&c.searchForVideosInWindow(a.contentWindow)}this.searchForVideosInWindow(window);for(var d=window.document.getElementsByTagName("iframe"),c=this,e=0;e<d.length;e++)a(d[e]);c=this;setTimeout(function(){c.trackVideos()},this.SearchForNewVideoPlayersInterval)};this.searchForVideosInWindow=
function(a){try{a.jwplayer}catch(d){return}this.searchForFlowPlayerPlayersInWindow(a);this.searchForJWPlayerPlayersInWindow(a);this.searchForVideoJSPlayersInWindow(a)};this.searchForFlowPlayerPlayersInWindow=function(a){if(a.flowplayer){var b=[],c=0;if("undefined"!=typeof a.flowplayer.instances)for(a.flowplayer.instances.forEach(function(a){b.push(a)}),c=0;c<b.length;c++)0>this.foundVideoPlayers.indexOf(b[c])&&(this.foundVideoPlayers.push(b[c]),this.newVideoFoundCallback("flowPlayer",b[c]))}};this.searchForJWPlayerPlayersInWindow=
function(a){if(a.jwplayer){var b=[];for(c=0;a.jwplayer(c).id;)b.push(a.jwplayer(c)),c++;for(var c=0;c<b.length;c++){a=!0;for(var e=0;e<this.foundVideoPlayers.length;e++)this.foundVideoPlayers[e].id&&this.foundVideoPlayers[e].id==b[c].id&&(a=!1);a&&(this.foundVideoPlayers.push(b[c]),this.newVideoFoundCallback("jwPlayer",b[c]))}}};this.searchForVideoJSPlayersInWindow=function(a){if(a.videojs&&"object"==typeof a.videojs.players)for(videoId in a.videojs.players){var b=a.videojs.players[videoId];0>this.foundVideoPlayers.indexOf(b)&&
(this.foundVideoPlayers.push(b),this.newVideoFoundCallback("videojs",b))}}}function y(){this.formPostCount=this.pingSendCount=this.dataSendCount=0;this.callLimit=10;this.isRegExp=function(a){return"[object RegExp]"==Object.prototype.toString.call(a)};this.setCookie=function(a,b,d,c){var e=new Date;e.setDate(e.getDate()+d);c&&e.setMinutes(e.getMinutes()+c);b=escape(b)+(null==d?"":"; expires="+e.toUTCString());document.cookie=a+"="+b+";path=/;secure;"};this.getCookie=function(a){return this.hasCookie(a)?
this.listCookie()[a+""]:null};this.hasCookie=function(a){return(new RegExp("(?:;\\s*|^)"+encodeURIComponent(a+"")+"=")).test(document.cookie)};this.lsAvailable=function(){try{var a=window.localStorage;a.setItem("__storage_test__","__storage_test__");a.removeItem("__storage_test__");return!0}catch(b){return!1}};this.listCookie=function(a){for(var b=document.cookie.split(";"),d,c={},e=0,g=b.length;e<g;++e)if(d=b[e].split("="),d[0]=d[0].replace(/^\s+|\s+$/,""),!this.isRegExp(a)||a.test(d[0]))try{c[decodeURIComponent(d[0])]=
decodeURIComponent(d[1])}catch(f){}return c};this.sendData=function(a,b){var d=window.DotMetricsSettings;switch(a){case d.DataUrl:this.dataSendCount++;if(this.dataSendCount>this.callLimit)return;break;case d.PingUrl:if(this.pingSendCount++,this.pingSendCount>this.callLimit)return}b=this.encode(DotmetricsJSON.stringify(b));b=encodeURIComponent(b);d=(new Date).getTime();a=a+"?v="+b+"&r="+d;b=document.createElement("script");b.setAttribute("src",a);document.getElementsByTagName("head")[0].appendChild(b)};
this.performAjaxPost=function(a,b){b=this.encode(DotmetricsJSON.stringify(b));b=encodeURIComponent(b);var d=(new Date).getTime();b="v="+b+"&r="+d;a+="?"+(new Date).getTime();window.XDomainRequest?(d=new XDomainRequest,d.open("POST",a),d.send(b)):(d=null,window.XMLHttpRequest?d=new XMLHttpRequest:window.ActiveXObject&&(d=new ActiveXObject("Microsoft.XMLHTTP")),d.open("POST",a,!0),d.withCredentials=!0,d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.send(b))};this.performSendBeacon=
function(a,b){this.sendMessageToExtension({target:"dotmetrics-extension",type:"beacon",url:a,data:b});b=this.encode(DotmetricsJSON.stringify(b));b=encodeURIComponent(b);var d=(new Date).getTime();b=new Blob(["v="+b+"&r="+d],{type:"application/x-www-form-urlencoded"});return navigator.sendBeacon(a,b)};this.addEventSimple=function(a,b,d){a.addEventListener?a.addEventListener(b,d,!1):a.attachEvent&&a.attachEvent("on"+b,d)};this.removeEventSimple=function(a,b,d){a.removeEventListener?a.removeEventListener(b,
d,!1):a.detachEvent&&a.detachEvent("on"+b,d)};this.isIE=function(){return-1!=navigator.appName.indexOf("Microsof")?!0:!1};this.saveInLocalStorage=function(a){if(this.lsAvailable())for(var b in a)a.hasOwnProperty(b)&&window.localStorage.setItem(b+"",a[b])};this.getFromLocalStorage=function(a){return this.lsAvailable()?window.localStorage.getItem(a+""):null};this.removeFromLocalStorage=function(a){return this.lsAvailable()?window.localStorage.removeItem(a+""):null};this.CreateElement=function(a,b,d){if(null!=
a){a=document.createElement(a);if(null!=b)for(x in b)"function"==typeof b[x]?this.addEventSimple(a,x,b[x]):(a.setAttribute(x,b[x]),"class"==x&&(a.className=b[x]));null!=d&&(b=document.createTextNode(d.toString()),a.appendChild(b));return a}return null!=d?document.createTextNode(d.toString()):null};this.clientInfo=null;this.createClientInfo=function(a){function b(){r=k.detect(d[h])?r+"1":r+"0";h++;h>=d.length?(c.FontString=r,q.clientInfo=c,a&&a()):setTimeout(function(){b()},30)}if(this.clientInfo)a&&
a();else{var d="cursive;monospace;serif;sans-serif;fantasy;Arial;Arial Black;Arial Narrow;Arial Rounded MT Bold;Bookman Old Style;Bradley Hand ITC;Century;Century Gothic;Comic Sans MS;Courier;Courier New;Georgia;Gentium;Impact;King;Lucida Console;Lalit;Modena;Monotype Corsiva;Papyrus;Tahoma;TeX;Times;Times New Roman;Trebuchet MS;Verdana;Verona;Bell MT;Berlin Sans FB;Corbel;Kalinga;Miriam Regular;Modern Standard;Segoe UI;Segoe Print;Inconsolata;Droid Sans Mono;Anonymous Pro;Liberation Mono;Terminus;Rosario;Roboto Slab;Oswald;Stalemate;Crimson Text;Gravitas One;Jura;League Gothic;Fjord;Proxima Nova;Trivia Grotesk;Pluto Sans;Museo Sans;Futura;Al Bayan;American Typewriter;Andale Mono;Apple Casual;Apple Chancery;Apple Garamond;Apple Gothic;Apple LiGothic;Apple LiSung;Apple Myungjo;Apple Symbols;.AquaKana;Arial Hebrew;Ayuthaya;Baghdad;Baskerville;Beijing;BiauKai;Big Caslon;Brush Script;Chalkboard;Chalkduster;Charcoal;Charcoal CY;Chicago;Cochin;Comic Sans;Cooper;Copperplate;Corsiva Hebrew;DecoType Naskh;Devanagari;Didot;Euphemia UCAS;Fang Song;Gadget;Geeza Pro;Geezah;Geneva;Geneva CY;Gill Sans;Gujarati;Gung Seoche;Gurmukhi;Hangangche;HeadlineA;Hei;Helvetica;Helvetica CY;Helvetica Neue;Herculanum;Hiragino Kaku Gothic Pro;Hiragino Kaku Gothic ProN;Hiragino Kaku Gothic Std;Hiragino Kaku Gothic StdN;Hiragino Maru Gothic Pro;Hiragino Maru Gothic ProN;Hiragino Mincho Pro;Hiragino Mincho ProN;Hoefler Text;Inai Mathi;Jung Gothic;Kai;Keyboard;Krungthep;KufiStandard GK;LastResort;LiHei Pro;LiSong Pro;Lucida Grande;Marker Felt;Menlo;Monaco;Monaco CY;Mshtakan;Nadeem;New Peninim;New York;NISC GB18030;Optima;Osaka;Palatino;PC Myungjo;Pilgiche;Plantagenet Cherokee;Raanana;Sand;Sathu;Seoul;Shin Myungjo Neue;Silom;Skia;Song;ST FangSong;ST Heiti;ST Kaiti;ST Song;Symbol;Tae Graphic;Taipei;Techno;Textile;Thonburi;Times CY;Zapf Chancery;Zapf Dingbats;Zapfino;Abadi MT Condensed Light;Aharoni;Aldhabi;Andalus;Angsana New;AngsanaUPC;Aparajita;Arabic Typesetting;Arial Nova;Batang;BatangChe;Book Antiqua;Browallia New;BrowalliaUPC;Calibri;Calibri Light;Calisto MT;Cambria;Cambria Math;Candara;Consolas;Constantia;Copperplate Gothic Bold;Copperplate Gothic Light;Cordia New;CordiaUPC;DaunPenh;David;Dengxian;DFKai-SB;DilleniaUPC;DokChampa;Dotum;DotumChe;Ebrima;Estrangelo Edessa;EucrosiaUPC;Euphemia;FangSong;Franklin Gothic Medium;FrankRuehl;FreesiaUPC;Gabriola;Gadugi;Gautami;Georgia Pro;Gill Sans Nova;Gisha;Gulim;GulimChe;Gungsuh;GungsuhChe;IrisUPC;Iskoola Pota;JasmineUPC;KaiTi;Kartika;Khmer UI;KodchiangUPC;Kokila;Lao UI;Latha;Leelawadee;Leelawadee UI;Levenim MT;LilyUPC;Lucida Handwriting Italic;Lucida Sans Unicode;Malgun Gothic;Mangal;Manny ITC;Marlett;Meiryo;Meiryo UI;Microsoft Himalaya;Microsoft JhengHei;Microsoft JhengHei UI;Microsoft New Tai Lue;Microsoft PhagsPa;Microsoft Sans Serif;Microsoft Tai Le;Microsoft Uighur;Microsoft YaHei;Microsoft YaHei UI;Microsoft Yi Baiti;MingLiU, PMingLiU;MingLiU-ExtB, PMingLiU-ExtB;MingLiU_HKSCS;MingLiU_HKSCS-ExtB;Miriam, Miriam Fixed;Mongolian Baiti;MoolBoran;MS Gothic, MS PGothic;MS Mincho, MS PMincho;MS UI Gothic;MV Boli;Myanmar Text;Narkisim;Neue Haas Grotesk Text Pro;News Gothic MT;Nirmala UI;NSimSun;Nyala;Palatino Linotype;Raavi;Rockwell Nova;Rod;Sakkal Majalla;Sanskrit Text;Segoe MDL2 Assets;Segoe Script;Segoe UI v5.00[3];Segoe UI v5.01[4];Segoe UI v5.27[5];Segoe UI v5.35;Segoe UI Emoji;Segoe UI Historic[6];Segoe UI Symbol;Shonar Bangla;Shruti;SimHei;SimKai;Simplified Arabic;SimSun;SimSun-ExtB;Sitka Banner;Sitka Display;Sitka Heading;Sitka Small;Sitka Subheading;Sitka Text;Sylfaen;Traditional Arabic;Tunga;Urdu Typesetting;Utsaah;Vani;Verdana Pro;Vijaya;Vrinda;Webdings;Westminster;Wingdings;Yu Gothic;Yu Gothic UI;Yu Mincho;Abyssinica SIL;Bitstream Charter;Century Schoolbook L;Courier 10 Pitch;DejaVu Sans;DejaVu Sans Condensed;DejaVu Sans Light;DejaVu Sans Mono;DejaVu Serif;DejaVu Serif Condensed;Dingbats;Droid Arabic Kufi;Droid Arabic Naskh;Droid Naskh Shift Alt;Droid Sans;Droid Sans Arabic;Droid Sans Armenian;Droid Sans Ethiopic;Droid Sans Fallback;Droid Sans Georgian;Droid Sans Hebrew;Droid Sans Japanese;Droid Serif;FreeMono;FreeSans;FreeSerif;Gargi;Garuda;KacstArt;KacstBook;KacstDecorative;KacstDigital;KacstFarsi;KacstLetter;KacstNaskh;KacstOffice;KacstOne;KacstPen;KacstPoster;KacstQurn;KacstScreen;KacstTitle;KacstTitleL;Kedage;Khmer OS;Khmer OS System;Kinnari;Laksaman;Liberation Sans;Liberation Sans Narrow;Liberation Serif;LKLUG;Lohit Bengali;Lohit Devanagari;Lohit Gujarati;Lohit Punjabi;Lohit Tamil;Loma;Mallige;Meera;mry_KacstQurn;Mukti Narrow;NanumBarunGothic;NanumGothic;NanumMyeongjo;Nimbus Mono L;Nimbus Roman No9 L;Nimbus Sans L;Norasi;OpenSymbol;Padauk;Padauk Book;Phetsarath OT;Pothana2000;Purisa;Rachana;Rekha;Saab;Sawasdee;STIX;STIXGeneral;TakaoPGothic;Tibetan Machine Uni;Tlwg Typist;Tlwg Typo;TlwgMono;TlwgTypewriter;Ubuntu;Ubuntu Condensed;Ubuntu Light;Ubuntu Mono;Umpush;URW Bookman L;URW Chancery L;URW Gothic L;URW Palladio L;utkal;Vemana2000;Waree;WenQuanYi Micro Hei;WenQuanYi Micro Hei Mono;Academy Engraved LET;Apple Color Emoji;AppleGothic;Bangla Sangam MN;Bodoni 72;Bodoni 72 Oldstyle;Bodoni 72 Smallcaps;Bodoni Ornaments;Bradley Hand;Chalkboard SE;Devanagari Sangam MN;Gujarati Sangam MN;Gurmukhi MN;Heiti SC;Heiti TC;Kailasa;Kannada Sangam MN;Malayalam Sangam MN;Marion;Noteworthy;Oriya Sangam MN;Party LET;Sinhala Sangam MN;Snell Roundhand;Tamil Sangam MN;Telugu Sangam MN".split(";"),
c={};c.AppCodeName=window.navigator.appCodeName;c.AppName=window.navigator.appName;c.Version=window.navigator.appVersion;c.Language=window.navigator.language;c.Platform=window.navigator.platform;c.Product=window.navigator.product;c.ProductSub=window.navigator.productSub;c.UserAgent=window.navigator.userAgent;c.Vendor=window.navigator.vendor;c.VendorSub=window.navigator.vendorSub;c.BuildId=window.navigator.buildID;c.OsCpu=window.navigator.oscpu;c.Screen={};c.Screen.AvailableWidth=window.screen.availWidth;
c.Screen.AvailableHeight=window.screen.availHeight;c.Screen.PixelDepth=window.screen.pixelDepth;c.Screen.ColorDepth=window.screen.colorDepth;var e=window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI;c.Screen.Width=Math.round(window.screen.width*e);c.Screen.Height=Math.round(window.screen.height*e);null==c.Screen.Width&&(c.Screen.Width=c.Screen.AvailableWidth);null==c.Screen.Height&&(c.Screen.Height=c.Screen.AvailableHeight);c.Plugins=[];if(window.ActiveXObject){e=/[0-9]+/;
var g={flash:"ShockwaveFlash.ShockwaveFlash",pdf:"AcroPDF.PDF",silverlight:"AgControl.AgControl",quicktime:"QuickTime.QuickTime"};for(l in g){var f=this.msieDetect(g[l]);f&&(f=(f=e.exec(f))&&f[0]||"",f={},f.Name=g[l],f.FileName="",c.Plugins.push(f))}}else for(var h=0;h<window.navigator.plugins.length;h++){var l=window.navigator.plugins[h];e={};e.Name=l.name;e.FileName=l.filename;c.Plugins.push(e)}c.MimeTypes=[];for(h=0;l=window.navigator.mimeTypes[h];h++)e={},e.Type=l.type,e.Suffixes=l.suffixes,c.MimeTypes.push(e);
c.Canvas=this.CreateCanvasFP();var r="",k=new function(){var a=["monospace","sans-serif","serif"],b=document.getElementsByTagName("body")[0],c=document.createElement("span");c.style.fontSize="72px";c.innerHTML="mmmmmmmmmmlli";var d={},e={},g;for(g in a)c.style.fontFamily=a[g],b.appendChild(c),d[a[g]]=c.offsetWidth,e[a[g]]=c.offsetHeight,b.removeChild(c);this.detect=function(g){var f=!1,h;for(h in a){c.style.fontFamily=g+","+a[h];b.appendChild(c);var k=c.offsetWidth!=d[a[h]]||c.offsetHeight!=e[a[h]];
b.removeChild(c);f=f||k}return f}},q=this;h=0;setTimeout(function(){b()},20)}};this.msieDetect=function(a){try{var b=new ActiveXObject(a);try{return b.GetVariable("$version")}catch(c){try{return b.GetVersions()}catch(e){try{var d;for(a=1;9>a;a++)b.isVersionSupported(a+".0")&&(d=a);return d||!0}catch(g){return!0}}}}catch(c){return!1}};this.CreateCanvasFP=function(){var a=document.createElement("canvas");if(a.getContext&&a.getContext("2d")){a.width=250;a.height=250;document.getElementById("fingerprint-output");
for(var b=a.getContext("2d"),d=0;d<a.width/2;d++)b.moveTo(2*d,0),b.lineTo(4*d,a.height),b.strokeStyle="rgba(0, 0, 0, 0.1)",b.stroke();b.font="40px 'Arial'";for(d=0;3>d;d++)b.fillStyle="#41b4e7",b.fillText("Dotmetrics",10,50*d+75),b.fillStyle="rgba(255, 255, 255, 0.7)",b.fillText("Dotmetrics",20,50*d+75);a=a.toDataURL("image/jpeg",1);return this.SHA1(a).toString()}return null};this.CreateElement=function(a,b,d){if(null!=a){a=document.createElement(a);if(null!=b)for(x in b)"function"==typeof b[x]?this.addEventSimple(a,
x,b[x]):(a.setAttribute(x,b[x]),"class"==x&&this.isIE()&&(a.className=b[x]));null!=d&&(b=document.createTextNode(d.toString()),a.appendChild(b));return a}return null!=d?document.createTextNode(d.toString()):null};this.encode=function(a){var b="",d=0;for(a=this.utf8Encode(a);d<a.length;){var c=a.charCodeAt(d++);var e=a.charCodeAt(d++);var g=a.charCodeAt(d++);var f=c>>2;c=(c&3)<<4|e>>4;var h=(e&15)<<2|g>>6;var l=g&63;isNaN(e)?h=l=64:isNaN(g)&&(l=64);b=b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l)}return b};this.utf8Encode=function(a){a=a.replace(/\r\n/g,"\n");for(var b="",d=0;d<a.length;d++){var c=a.charCodeAt(d);128>c?b+=String.fromCharCode(c):(127<c&&2048>c?b+=String.fromCharCode(c>>6|192):(b+=String.fromCharCode(c>>12|224),b+=String.fromCharCode(c>>6&63|128)),
b+=String.fromCharCode(c&63|128))}return b};this.SHA1=function(a){function b(a,c){return a<<c|a>>>32-c}function d(a){var c="",b;for(b=7;0<=b;b--){var d=a>>>4*b&15;c+=d.toString(16)}return c}var c,e=Array(80),g=1732584193,f=4023233417,h=2562383102,l=271733878,r=3285377520;a=function(a){a=a.replace(/\r\n/g,"\n");for(var c="",b=0;b<a.length;b++){var d=a.charCodeAt(b);128>d?c+=String.fromCharCode(d):(127<d&&2048>d?c+=String.fromCharCode(d>>6|192):(c+=String.fromCharCode(d>>12|224),c+=String.fromCharCode(d>>
6&63|128)),c+=String.fromCharCode(d&63|128))}return c}(a);var k=a.length;var q=[];for(c=0;c<k-3;c+=4){var m=a.charCodeAt(c)<<24|a.charCodeAt(c+1)<<16|a.charCodeAt(c+2)<<8|a.charCodeAt(c+3);q.push(m)}switch(k%4){case 0:c=2147483648;break;case 1:c=a.charCodeAt(k-1)<<24|8388608;break;case 2:c=a.charCodeAt(k-2)<<24|a.charCodeAt(k-1)<<16|32768;break;case 3:c=a.charCodeAt(k-3)<<24|a.charCodeAt(k-2)<<16|a.charCodeAt(k-1)<<8|128}for(q.push(c);14!=q.length%16;)q.push(0);q.push(k>>>29);q.push(k<<3&4294967295);
for(a=0;a<q.length;a+=16){for(c=0;16>c;c++)e[c]=q[a+c];for(c=16;79>=c;c++)e[c]=b(e[c-3]^e[c-8]^e[c-14]^e[c-16],1);m=g;k=f;var n=h;var p=l;var t=r;for(c=0;19>=c;c++){var u=b(m,5)+(k&n|~k&p)+t+e[c]+1518500249&4294967295;t=p;p=n;n=b(k,30);k=m;m=u}for(c=20;39>=c;c++)u=b(m,5)+(k^n^p)+t+e[c]+1859775393&4294967295,t=p,p=n,n=b(k,30),k=m,m=u;for(c=40;59>=c;c++)u=b(m,5)+(k&n|k&p|n&p)+t+e[c]+2400959708&4294967295,t=p,p=n,n=b(k,30),k=m,m=u;for(c=60;79>=c;c++)u=b(m,5)+(k^n^p)+t+e[c]+3395469782&4294967295,t=p,
p=n,n=b(k,30),k=m,m=u;g=g+m&4294967295;f=f+k&4294967295;h=h+n&4294967295;l=l+p&4294967295;r=r+t&4294967295}u=d(g)+d(f)+d(h)+d(l)+d(r);return u.toLowerCase()};this.sendMessageToExtension=function(a){window.sendMessageToDotmetricsExtension&&window.sendMessageToDotmetricsExtension(a)};this.postMessage=function(a){try{window.postMessage(a,window.location.origin)}catch(b){}}}var v=new function(){this.SettingsObject=window.DotMetricsSettings;this.Core=new y;this.EnterPageEventData=null;this.TimeOnPage=
0;this.LastSentTimeOnPage=-1;this.TimeBuffer=0;this.TimeTreshold=18E5;this.surveyLink=this.LoadTimeStamp="";this.DeviceGuidId=this.UserId=this.DeviceId=null;this.deviceInfoSent=!1;this.postIndex=0;this.surveyDone=this.Done=!1;this.ajaxTimer=null;this.panel=!1;this.panelHouseholdId=this.panelUserId=null;this.videos={};this.foundVideoPlayers=[];this.SaveTimeOnPageInterval=1E4;this.MaxTimeOnPageItemsInCookie=8;this.fbInstantArticle=!1;this.lastInteraction=this.saveTimeOnPageIntervalFunctionId=this.timeBufferIntervalInstanceId=
null;this.Start=function(){var a=this;0<=navigator.userAgent.indexOf("FBIA")&&(a.fbInstantArticle=!0);document.addEventListener("visibilitychange",function(){if("hidden"===document.visibilityState){a.stopIntervalFunctions();a.emptyTimeBuffer();var b=a.SendTimeOnPageBeacon();a.SaveTimeOnPage(b)}else"visible"===document.visibilityState&&a.startIntervalFunctions()});a.startIntervalFunctions();this.initPanelElements();this.initInteractionEvents();this.listenForExtensionMessages();var b=this.createStartData();
a.Core.sendData(this.SettingsObject.DataUrl,b);if(window.dm)this.onAjaxDataUpdate();1==this.SettingsObject.VideoTrackingEnabled&&this.trackVideos()};this.listenForExtensionMessages=function(){var a=this;window.addEventListener("message",function(b){b.data.source&&"dotmetrics-extension"==b.data.source&&b.data.type&&a.handleExtensionRequest(b.data.type)})};this.handleExtensionRequest=function(a){switch(a){case "timeOnPage":a=this.createCurrentTimeOnPageObject();var b=this.getTimeOnPageDataTemplate();
b.ep.push(a);this.Core.sendMessageToExtension({target:"dotmetrics-extension",type:"timeOnPage",data:b});break;case "getEnterPageData":this.EnterPageEventData&&this.Core.postMessage({target:"dotmetrics-plugin",type:"enterPageData",data:this.EnterPageEventData})}};this.createStartData=function(){var a=(new Date).getTimezoneOffset();a={id:this.SettingsObject.SiteSectionId,fl:!0,dom:window.location.hostname,lso:null,url:window.location.href,rurl:window.document.referrer,pvid:this.SettingsObject.PVID,
tzOffset:a};this.panel&&(a.hhid=this.panelHouseholdId,a.uid=this.panelUserId);var b="DM_SitId"+this.SettingsObject.SiteId,d="DM_SitIdT"+this.SettingsObject.SiteId,c=b+"SecId"+this.SettingsObject.SiteSectionId,e=b+"SecIdT"+this.SettingsObject.SiteSectionId,g=this.Core.getFromLocalStorage("DotmetricsSiteData");g=g?DotmetricsJSON.parse(g):{};var f=(new Date).getTime()-18E5;for(h in g)g[h]<f&&delete g[h];this.Core.hasCookie(b)&&g.hasOwnProperty(d)?a.oss=!1:(this.Core.setCookie(b,"1"),a.oss=!0);this.Core.hasCookie(c)&&
g.hasOwnProperty(e)?a.oses=!1:(this.Core.setCookie(c,"1"),a.oses=!0);var h=(new Date).getTime();g[d]=h;g[e]=h;d={DotmetricsSiteData:JSON.stringify(g)};this.Core.saveInLocalStorage(d);return a};this.processActions=function(a){var b=this,d=(new Date).getTimezoneOffset();d={id:this.SettingsObject.SiteSectionId,fl:!1,dom:window.location.hostname,lso:null,ds:null,dsl:null,dh:null,url:window.location.href,rurl:window.document.referrer,pvid:this.SettingsObject.PVID,tzOffset:d};this.panel&&(d.hhid=this.panelHouseholdId,
d.uid=this.panelUserId);var c=!1;if(a.SendDeviceInfo||a.Ping){var e={deviceInfo:!1,pings:0,exitPageData:!1};a.Ping&&0<a.Ping&&0==this.deviceInfoSent&&(e.pings=a.Ping);a.SendDeviceInfo&&0==this.deviceInfoSent&&(this.deviceInfoSent=e.deviceInfo=!0);this.submitData(e)}if(a.Survey&&a.Survey.SurveyUrl)if(this.Survey=a.Survey,this.Survey.Mobile){var g=this;this.anchor=this.Core.CreateElement("a",{href:a.Survey.SurveyUrl,style:"position:fixed; width:100%; height:100%; top:0; left:0; background:#f00; opacity:0;z-index:99999",
target:"_blank",id:"DotMetricsPopupLink"},null);document.body.appendChild(this.anchor);this.Core.addEventSimple(this.anchor,"click",function(a){a.preventDefault();var c=g.anchor.getAttribute("href");document.body.removeChild(g.anchor);g.surveyDone||(g.surveyDone=!0,setTimeout(function(){window.open(c,"_blank")},20))})}else{var f=function(){document.body.addEventListener?document.body.removeEventListener("click",f):document.body.detachEvent("onclick",f);b.showSurvey()};document.body.addEventListener?
document.body.addEventListener("click",f,!1):document.body.attachEvent("onclick",f)}if(a.SendDeviceHash)if(this.Core.clientInfo)c=DotmetricsJSON.stringify(this.Core.clientInfo),c=this.Core.SHA1(c),d.dh=c.toString(),c=!0;else{this.Core.createClientInfo(function(){b.processActions(a)});return}a.PersistDeviceAndUser&&a.DeviceId&&a.UserId&&a.DeviceGuidId&&this.Core.saveInLocalStorage({DotMetricsDeviceId:a.DeviceId,DotMetricsUserId:a.UserId,DotMetricsDeviceGuidId:a.DeviceGuidId});if(a.SendLSO){c=this.Core.getFromLocalStorage("DotMetricsUserId");
e=this.Core.getFromLocalStorage("DotMetricsDeviceId");var h=this.Core.getFromLocalStorage("DotMetricsDeviceGuidId");d.lso=c&&e&&h?{d:e,u:c,dg:h}:{d:"",u:"00000000-0000-0000-0000-000000000000",dg:"00000000-0000-0000-0000-000000000000"};c=!0}c&&b.Core.sendData(this.SettingsObject.DataUrl,d)};this._timeData=[];this._requestedPingsNum=this._currentRequestNum=0;this._onPingMeasurmentsDone=null;this._pingStartTime=0;this.measurePingTimes=function(a,b){this._timeData=[];this._currentRequestNum=0;this._requestedPingsNum=
a;this._onPingMeasurmentsDone=b;this.makePingRequest()};this.makePingRequest=function(){this._pingStartTime=(new Date).getTime();var a=0==this._timeData.length?{ctd:0,cl:0}:this._timeData[this._timeData.length-1];a.ct=this._pingStartTime;this.Core.sendData(this.SettingsObject.PingUrl,a)};this.HandlePing=function(a){var b=(new Date).getTime(),d=(b-this._pingStartTime)/2;this._timeData.push({ctd:a.s-b-Math.abs(d),cl:d});this._currentRequestNum++;if(this._currentRequestNum<this._requestedPingsNum)this.makePingRequest();
else{for(d=b=a=0;d<this._timeData.length;d++)a+=this._timeData[d].ctd,b+=this._timeData[d].cl;a=Math.round(a/this._timeData.length);b=Math.round(b/this._timeData.length);a={DeviceSync:a,DeviceSyncLag:b};this._onPingMeasurmentsDone(a)}};this.showSurvey=function(){this.surveyDone||(this.surveyDone=!0,window.open(this.Survey.SurveyUrl,"","width="+this.Survey.WindowWidth+",height="+this.Survey.WindowHeight+",scrollbars=1").focus())};this.startIntervalFunctions=function(){var a=this;null==this.timeBufferIntervalInstanceId&&
(this.timeBufferIntervalInstanceId=setInterval(function(){void 0!=document.visibilityState?"visible"==document.visibilityState&&a.TimeBuffer++:a.TimeBuffer++;a.fbInstantArticle&&a.emptyTimeBuffer()},1E3));null==this.saveTimeOnPageIntervalInstanceId&&(this.saveTimeOnPageIntervalFunctionId=setInterval(function(){a.SaveTimeOnPage()},a.SaveTimeOnPageInterval))};this.stopIntervalFunctions=function(){this.timeBufferIntervalInstanceId&&(clearInterval(this.timeBufferIntervalInstanceId),this.timeBufferIntervalInstanceId=
null);this.saveTimeOnPageIntervalFunctionId&&(clearInterval(this.saveTimeOnPageIntervalFunctionId),this.saveTimeOnPageIntervalFunctionId=null)};this.emptyTimeBuffer=function(){if((new Date).getTime()-this.lastInteraction.getTime()<=this.TimeTreshold||this.fbInstantArticle)this.TimeOnPage+=this.TimeBuffer;this.TimeBuffer=0;this.lastInteraction=new Date};this.SendTimeOnPageBeacon=function(){if(this.LastSentTimeOnPage==this.TimeOnPage)return!0;if(navigator.sendBeacon&&this.EnterPageEventData){var a=
this.createCurrentTimeOnPageObject(),b=this.getTimeOnPageDataTemplate();b.ep.push(a);this.LastSentTimeOnPage=this.TimeOnPage;return this.Core.performSendBeacon(this.SettingsObject.BeaconUrl,b)}return!1};this.createCurrentTimeOnPageObject=function(){return{cd:this.EnterPageEventData.CreationDate,eid:this.EnterPageEventData.EventId,id:this.EnterPageEventData.SiteSectionId,sop:this.TimeOnPage,vl:this.getVideoData(),url:window.location.href,rurl:window.document.referrer,pvid:this.SettingsObject.PVID}};
this.getTimeOnPageDataTemplate=function(){var a=(new Date).getTimezoneOffset();a={id:this.SettingsObject.SiteSectionId,cd:{d:this.DeviceId,u:this.UserId,dg:this.DeviceGuidId},ep:[],tzOffset:a};this.panel&&(a.hhid=this.panelHouseholdId,a.uid=this.panelUserId);return a};this.SaveTimeOnPage=function(a){if(0!=this.Core.lsAvailable()&&null!=this.EnterPageEventData){for(var b=this.getTimeOnPageData(),d=0;d<b.length;d++)if(b[d].eid==this.EnterPageEventData.EventId){b.splice(d,1);break}a||(a=this.createCurrentTimeOnPageObject(),
b.push(a));a={};a[this.SettingsObject.TimeOnPage]=DotmetricsJSON.stringify(b);this.Core.saveInLocalStorage(a)}};this.processTimeOnPageData=function(){if(0==this.Core.lsAvailable())return null;for(var a=[],b=this.getTimeOnPageData(),d=new Date,c=0;c<b.length;c++)try{var e=b[c],g=new Date(e.cd);864E5>d.getTime()-g.getTime()&&a.push(e)}catch(f){}0==a.length&&(a=null);this.Core.removeFromLocalStorage(this.SettingsObject.TimeOnPage);return a};this.getTimeOnPageData=function(){var a=this.Core.getFromLocalStorage(this.SettingsObject.TimeOnPage),
b=[];if(null!=a&&0<a.length)try{b=DotmetricsJSON.parse(a)}catch(d){b=JSON.parse(a)}return b};this.initInteractionEvents=function(){this.lastInteraction=new Date;var a=this;this.Core.addEventSimple(document,"mousemove",function(){a.emptyTimeBuffer()});this.Core.addEventSimple(document,"wheel",function(){a.emptyTimeBuffer()});this.Core.addEventSimple(document,"touchend",function(){a.emptyTimeBuffer()})};this.initPanelElements=function(){if(document.getElementById("DotmetricsPanelUserId")&&document.getElementById("DotmetricsPanelHouseholdId")){this.panel=
!0;this.panelUserId=document.getElementById("DotmetricsPanelUserId").value;this.panelHouseholdId=document.getElementById("DotmetricsPanelHouseholdId").value;var a=document.createElement("input");a.setAttribute("type","hidden");a.setAttribute("id","DotmetricsScriptLoaded");a.setAttribute("value","true");document.getElementsByTagName("head")[0].appendChild(a)}};this.CreateIframe=function(){this.iFrameHolderDiv=this.Core.CreateElement("div",{id:"DotMetricsPF",style:"display:none;width:0px;height:0px;position:absolute; left:-2000px;"},
null);var a="dotmetricsframe"+this.postIndex;this.postIndex++;this.iFrameHolderDiv.style.display="none";try{this.iframe=document.createElement('<iframe name="'+a+'" style:"display:none;width:0px;height:0px;">')}catch(b){this.iframe=this.Core.CreateElement("iframe",{name:a,id:a,style:"display:none;width:0px;height:0px;"},null)}this.iframe.id=a;this.form=this.Core.CreateElement("form",{action:this.SettingsObject.PostUrl,method:"post",target:a,id:"DotMetricsForm"},null);this.formInput=this.Core.CreateElement("input",
{type:"text",name:"v"},null);document.body.appendChild(this.iFrameHolderDiv);this.iFrameHolderDiv.appendChild(this.iframe);this.iFrameHolderDiv.appendChild(this.form);this.form.appendChild(this.formInput);document.getElementById("DotMetricsForm").target=a};this.submitData=function(a){function b(){d.CreateIframe();d.formInput.value=DotmetricsJSON.stringify(e);d.form.submit();var a=d.iFrameHolderDiv;setTimeout(function(){document.body.removeChild(a)},5E3)}var d=this;this.Core.formPostCount++;if(!(this.Core.formPostCount>
this.Core.callLimit)){var c=(new Date).getTimezoneOffset(),e={id:this.SettingsObject.SiteSectionId,cd:{d:this.DeviceId,u:this.UserId,dg:this.DeviceGuidId},di:null,ds:0,dsl:0,url:window.location.href,rurl:window.document.referrer,pvid:this.SettingsObject.PVID,tzOffset:c};this.panel&&(e.hhid=this.panelHouseholdId,e.uid=this.panelUserId);if(a.deviceInfo)if(this.Core.clientInfo)e.di=this.Core.clientInfo;else{this.Core.createClientInfo(function(){d.submitData(a)});return}0<a.pings?this.measurePingTimes(a.pings,
function(a){e.ds=a.DeviceSync;e.dsl=a.DeviceSyncLag;b()}):b()}};this.HandleJsonp=function(a){var b=this;b.Core.sendMessageToExtension({target:"dotmetrics-extension",type:"jsonpResponse",data:a,pvid:this.SettingsObject.PVID});this.UserId=a.UserId;this.DeviceId=a.DeviceId;this.DeviceGuidId=a.DeviceGuidId;window.DotMetricsObj.DeviceId=this.DeviceId;window.DotMetricsObj.UserId=this.UserId;this.deviceInfoSent&&(a.SendDeviceInfo=!1,a.Ping=0);if(this.firstLoadDone)this.processActions(a);else{this.firstLoadDone=
!0;this.EnterPageEventData=a.EnterPageEventData;window.DotMetricsObj.firstLoadDone=!0;window.DotMetricsObj.EnterPageEventData=a.EnterPageEventData;var d={deviceInfo:!1,pings:0};1==a.SendDeviceInfo&&0==this.deviceInfoSent&&(d.deviceInfo=!0,a.SendDeviceInfo=!1,this.deviceInfoSent=!0);a.Ping&&0<a.Ping&&(d.pings=a.Ping,a.Ping=!1);setTimeout(function(){(d.deviceInfo||d.pings)&&b.submitData(d);var c=b.processTimeOnPageData();b.Core.setCookie(b.SettingsObject.TimeOnPage,null,0);if(c){var e=b.getTimeOnPageDataTemplate();
e.ep=c;b.Core.performAjaxPost(b.SettingsObject.BeaconUrl,e)}b.processActions(a)},1E3*Math.random()+500)}};this.onAjaxDataUpdate=function(){var a=window.dm,b=this;null==this.ajaxTimer&&0<a.AjaxData.length&&(this.ajaxTimer=setTimeout(function(){var d=b.prepareAjaxData(a.AjaxData);a.AjaxData.length=0;b.ajaxTimer=null;b.Core.performAjaxPost(b.SettingsObject.AjaxEventUrl,d)},this.SettingsObject.AjaxEventTimeout))};this.prepareAjaxData=function(a){var b=(new Date).getTimezoneOffset(),d={siteSectionId:this.SettingsObject.SiteSectionId,
pvid:this.SettingsObject.PVID,domain:window.location.hostname,events:[],tzOffset:b};this.panel&&(d.hhid=this.panelHouseholdId,d.uid=this.panelUserId);var c=this;a.forEach(function(a){var b={};b.eventType=a.et?a.et:"pageview";b.eventData=a.d?a.d:null;b.eventSiteSectionId=a.ssid?a.ssid:c.SettingsObject.SiteSectionId;isNaN(b.eventSiteSectionId)&&(b.eventTag=b.eventSiteSectionId,delete b.eventSiteSectionId);b.url=a.url?a.url:window.location.href;d.events.push(b)});return d};this.trackVideos=function(){var a=
this;(new w(function(b,d){switch(b){case "flowPlayer":a.trackFP(d);break;case "jwPlayer":a.trackJW(d);break;case "videojs":a.trackVideoJS(d)}})).init()};this.trackFP=function(a){function b(){var b="";try{b=a.opts.title}catch(f){}return a.currentSrc+"_"+b}function d(){var d="";try{d=a.opts.title}catch(l){}var e=Math.max(0,a.duration),h=b();c.videos[h]={vid:a.currentSrc,w:a.videoWidth,h:a.videoHeight,vdur:e,tw:0,ls:a.opts.live,t:d}}var c=this,e=null;a.on("loadedmetadata",function(a){d()});a.on("seeked",
function(b){e=a.currentTime});a.on("timeupdate",function(g){if(e&&0==a.playerState["is-seeking"]&&(g=a.currentTime-e,0<g)){if(1<g)return;var f=b();c.videos[f]?(c.videos[f].tw+=g,c.videos[f].vdur<a.duration&&(c.videos[f].vdur=a.duration)):d()}e=a.currentTime})};this.trackJW=function(a){function b(){var b=a.getPlaylistItem();if("undefined"!=typeof b){var g=b.file+"_"+b.title;if(!d.videos[g]){var f=a.getConfig();d.videos[g]={vid:b.file,w:a.getWidth(),h:a.getHeight(),vdur:a.getDuration(),tw:0,ls:f&&"Live"==
f.streamType,t:b.title};0>d.videos[g].vdur&&(d.videos[g].vdur=0)}c=a.getPosition()}}var d=this,c=null;a.on("play",function(a){b()});a.on("seek",function(a){c=a.offset});a.on("time",function(e){if(c){var g=e.position-c,f=a.getPlaylistItem();if("undefined"==typeof f)return;f=f.file+"_"+f.title;"undefined"==typeof d.videos[f]&&b();0<g&&(d.videos[f].tw+=g);d.videos[f].h||(d.videos[f].h=a.getHeight());d.videos[f].w||(d.videos[f].w=a.getWidth());if(!d.videos[f].vdur||d.videos[f].vdur<a.getDuration())d.videos[f].vdur=
a.getDuration()}c=e.position})};this.trackVideoJS=function(a){function b(){var b=a.mediainfo?a.mediainfo.name:"";return a.currentSrc()+"_"+b}function d(){var d=a.currentSrc();if(""!=d){var e=b();c.videos[e]||(c.videos[e]={vid:d,w:"function"==typeof a.videoWidth?a.videoWidth():a.width(),h:"function"==typeof a.videoHeight?a.videoHeight():a.height(),vdur:a.duration(),tw:0,ls:!1,t:a.mediainfo?a.mediainfo.name:""},0>c.videos[e].vdur&&(c.videos[e].vdur=0))}}var c=this,e=null;a.on("loadedmetadata",function(){d()});
a.on("timeupdate",function(){if(e&&0==a.seeking()&&("function"==typeof a.scrubbing?0==a.scrubbing():1)){var g=a.currentTime()-e;if(""==a.currentSrc())return;var f=b();if("undefined"==typeof c.videos[f]){d();return}try{c.videos[f].ls=c.videos[f].ls||"undefined"!=a.liveTracker&&a.liveTracker.isLive&&a.liveTracker.isLive()}catch(h){}c.videos[f].vdur<a.duration()&&(c.videos[f].vdur=a.duration());0<g&&(c.videos[f].tw+=g)}e=a.currentTime()})};this.getVideoData=function(){var a=this.videos,b=[],d;for(d in a)if(a.hasOwnProperty(d)){var c=
a[d];!c.vid||""==c.vid||0<=c.vid.indexOf("data:video")||(c.w=Math.round(c.w),c.h=Math.round(c.h),c.w||(c.w=0),c.h||(c.h=0),c.vdur&&isFinite(c.vdur)?(c.vdur=Math.round(c.vdur),0>c.vdur&&(c.vdur=0)):c.vdur=0,0<c.tw&&1>c.tw&&(c.tw=1),c.tw=Math.round(c.tw),0<c.tw&&b.push(c))}return b}};window.DotMetricsObj={onAjaxDataUpdate:function(){v.onAjaxDataUpdate()},HandleJsonp:function(a){v.HandleJsonp(a)},HandlePing:function(a){v.HandlePing(a)}};top.location==self.location&&setTimeout(function(){v.Start()},100)})(window);
